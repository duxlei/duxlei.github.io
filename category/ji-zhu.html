<!DOCTYPE html>
<html lang="zh-cn">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>DuXLei - 技术</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">DuXLei</a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/ji-zhu.html">技术</a></li>
                    <li><a href="/category/gu-shi.html">故事</a></li>
                    <li><a href="/category/about.html">About</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/ru-men-xue-xi-pelican.html">入门学习Pelican</a></h1>
<footer class="post-info">
        <abbr class="published" title="2022-06-12T21:10:00+08:00">
                Published: 周日 12 六月 2022
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/duhg.html">duhg</a>
        </address>
<p>In <a href="/category/ji-zhu.html">技术</a>.</p>

</footer><!-- /.post-info --><h3>Quickstart</h3>
<h6></h6>
<p>Reading through all the documentation is highly recommended, but for the truly
impatient, following are some quick steps to get started.</p>
<h2>Installation</h2>
<p>Install Pelican (and optionally Markdown if you intend to use it) on Python
3.6+ by running the following command in your preferred terminal, prefixing
with <code>sudo</code> if permissions warrant::</p>
<div class="highlight"><pre><span></span><code><span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="ss">&quot;pelican[markdown]&quot;</span><span class="w"></span>
</code></pre></div>

<h2>Create a project</h2>
<p>First, choose a name for your project, create an appropriately-named directory
for your site, and switch to that directory::</p>
<div class="highlight"><pre><span></span><code>mkdir -p ~/projects/yoursite
cd ~/projects/yoursite
</code></pre></div>

<p>Create a skeleton project via the <code>pelican-quickstart</code> command, which begins
by asking some questions about your site::</p>
<div class="highlight"><pre><span></span><code>pelican-quickstart
</code></pre></div>

<p>For questions that have default values denoted in brackets, feel free to use
the Return key to accept those default values [#tzlocal_fn]_. When asked for
your URL prefix, enter your domain name as indicated (e.g.,
<code>https://example.com</code>).</p>
<h2>Create an article</h2>
<p>You cannot run Pelican until you have created some content. Use your preferred
text editor to create your first article with the following content::</p>
<div class="highlight"><pre><span></span><code><span class="n">Title</span><span class="o">:</span><span class="w"> </span><span class="n">My</span><span class="w"> </span><span class="n">First</span><span class="w"> </span><span class="n">Review</span><span class="w"></span>
<span class="n">Date</span><span class="o">:</span><span class="w"> </span><span class="mi">2010</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">03</span><span class="w"> </span><span class="mi">10</span><span class="o">:</span><span class="mi">20</span><span class="w"></span>
<span class="n">Category</span><span class="o">:</span><span class="w"> </span><span class="n">Review</span><span class="w"></span>

<span class="n">Following</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">review</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">favorite</span><span class="w"> </span><span class="n">mechanical</span><span class="w"> </span><span class="n">keyboard</span><span class="o">.</span><span class="w"></span>
</code></pre></div>

<p>Given that this example article is in Markdown format, save it as
<code>~/projects/yoursite/content/keyboard-review.md</code>.</p>
<h2>Generate your site</h2>
<p>From your project root directory, run the <code>pelican</code> command to generate your site::</p>
<div class="highlight"><pre><span></span><code>pelican content
</code></pre></div>

<p>Your site has now been generated inside the <code>output/</code> directory. (You may see
a warning related to feeds, but that is normal when developing locally and can
be ignored for now.)</p>
<h2>Preview your site</h2>
<p>Open a new terminal session, navigate to your project root directory, and
run the following command to launch Pelican's web server::</p>
<div class="highlight"><pre><span></span><code>pelican --listen
</code></pre></div>

<p>Preview your site by navigating to http://localhost:8000/ in your browser.</p>
<p>Continue reading the other documentation sections for more detail, and check
out the Pelican wiki's Tutorials_ page for links to community-published
tutorials.</p>
<p>.. _Tutorials: https://github.com/getpelican/pelican/wiki/Tutorials</p>
<h2>Footnotes</h2>
<p>[#tzlocal_fn] You can help localize default fields by installing the
                 optional <a href="https://goo.gl/maps/beb4uMP1BrfarYEL6">tzlocal</a> module.</p>
<h2>Code simple</h2>
<div class="highlight"><pre><span></span><code>  <span class="c1"># POST请求</span>
  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Basic YWRtaW46MTIz&#39;</span><span class="p">,</span>
      <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
  <span class="p">}</span>

  <span class="n">hobby</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;篮球&#39;</span><span class="p">,</span><span class="s1">&#39;足球&#39;</span><span class="p">,</span><span class="s1">&#39;乒乓球&#39;</span><span class="p">,</span><span class="s1">&#39;羽毛球&#39;</span><span class="p">,</span><span class="s1">&#39;板球&#39;</span><span class="p">,</span><span class="s1">&#39;打游戏&#39;</span><span class="p">,</span><span class="s1">&#39;写代码&#39;</span><span class="p">,</span><span class="s1">&#39;看动漫&#39;</span><span class="p">,</span><span class="s1">&#39;逛B站&#39;</span><span class="p">,</span><span class="s1">&#39;美剧&#39;</span><span class="p">]</span>

  <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span>
      <span class="n">sf</span> <span class="o">=</span> <span class="n">gen_xm</span><span class="o">.</span><span class="n">ss</span><span class="p">()</span>
      <span class="n">jsonData</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">gen_xm</span><span class="o">.</span><span class="n">xm</span><span class="p">(),</span>
          <span class="s2">&quot;tel&quot;</span><span class="p">:</span> <span class="n">gen_xm</span><span class="o">.</span><span class="n">tel</span><span class="p">(),</span>
          <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="s2">&quot;中国&quot;</span><span class="p">,</span>
          <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="n">sf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
          <span class="s2">&quot;province&quot;</span><span class="p">:</span> <span class="n">sf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
          <span class="s2">&quot;hobby&quot;</span><span class="p">:</span> <span class="n">hobby</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hobby</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
          <span class="s2">&quot;favorite&quot;</span><span class="p">:</span> <span class="n">hobby</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hobby</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
          <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="n">postReq</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://localhost:4080/api/shop-crm/_doc&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jsonData</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">get_current_time</span><span class="p">(),</span> <span class="n">jsonData</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nd">@Component</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SaasUserTagSyncListener</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ApplicationRunner</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">MESSAGE_ENCODING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Utf-8&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;shop.crm.saasUserTagSync.sub&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">subscription</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="nd">@Autowired</span><span class="w"></span>
<span class="w">      </span><span class="kd">private</span><span class="w"> </span><span class="n">SaasUserTagSyncService</span><span class="w"> </span><span class="n">saasUserTagSyncService</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">IConsumeCallback</span><span class="w"> </span><span class="n">consumeCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messageExt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="c1">// 处理业务逻辑，完成后返回CONSUME_SUCCESS状态</span><span class="w"></span>
<span class="w">              </span><span class="n">Message</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">messageExt</span><span class="p">.</span><span class="na">getMessage</span><span class="p">();</span><span class="w"></span>
<span class="w">              </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">getData</span><span class="p">(),</span><span class="w"> </span><span class="n">MESSAGE_ENCODING</span><span class="p">);</span><span class="w"></span>
<span class="w">              </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;SaaS客户标签同步消息，msg：{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>
<span class="w">              </span><span class="n">SaasUserTagSyncBO</span><span class="w"> </span><span class="n">syncBo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JSON</span><span class="p">.</span><span class="na">parseObject</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">SaasUserTagSyncBO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">              </span><span class="n">saasUserTagSyncService</span><span class="p">.</span><span class="na">syncUserTag</span><span class="p">(</span><span class="n">syncBo</span><span class="p">);</span><span class="w"></span>
<span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="n">ConsumeStatus</span><span class="p">.</span><span class="na">CONSUME_SUCCESS</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="n">ConsumeStatus</span><span class="p">.</span><span class="na">RECONSUME_LATER</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">};</span><span class="w"></span>

<span class="w">      </span><span class="nd">@Override</span><span class="w"></span>
<span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="n">ApplicationArguments</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="c1">// 创建推模式的消费者</span><span class="w"></span>
<span class="w">          </span><span class="n">IPushConsumer</span><span class="w"> </span><span class="n">consumer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MercuryClient</span><span class="p">.</span><span class="na">createPushConsumer</span><span class="p">(</span><span class="n">subscription</span><span class="p">,</span><span class="w"> </span><span class="n">consumeCallback</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">consumer</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</code></pre></div>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>